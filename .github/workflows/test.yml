name: Tests

on:
    push:
      branches:
        - '*.x'
        - 'master'
    pull_request:
    schedule:
        - cron: '0 */12 * * *'

jobs:
    test:
        runs-on: ubuntu-latest
        strategy:
            fail-fast: false
            matrix:
                php: ['8.0', '8.1']
                laravel: [9.*]
                service: ['5.7', '8']
                dependency-version: [prefer-lowest, prefer-stable]

        name: 'PHP ${{ matrix.php }} / Laravel: ${{ matrix.laravel }} / ${{ matrix.dependency-version }} / MySQL ${{ matrix.service }}'

        steps:
            - uses: actions/checkout@v2

            - name: Run tests
              run: ./test --php ${{ matrix.php }} --laravel ${{ matrix.laravel }} --db ${{ matrix.service }} --dependencies ${{ matrix.dependency-version }}
