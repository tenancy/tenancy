name: Coverage

on: [push, pull_request]

jobs:
    coverage:
        runs-on: ubuntu-18.04

        env:
          PHP_VERSION: '8.0'
          DB_VERSION: '8'

        steps:
            - uses: actions/checkout@master

            - name: Start Environment
              run: ./tenancy start ${{ matrix.php }} ${{ matrix.service }}

            - name: Install dependencies
              run: ./tenancy composer install

            - name: Run tests for coverage
              run: ./tenancy ci --coverage-clover=coverage.xml
              env:
                  TENANCY_DB: testing
                  TENANCY_USERNAME: testing
                  TENANCY_PASSWORD: testing
                  PHP_VERSION: ${{ env.PHP_VERSION }}
                  DB_VERSION: ${{ env.DB_VERSION }}
                  APP_KEY: deela5kinohw0haekoothahSh8eexach

            - name: Upload coverage
              run: bash <(curl -s https://codecov.io/bash)
